-
<!DOCTYPE html>
<html lang="en">

<head>
    <title>MapD</title>
    <meta charset="UTF-8">
    <style></style>
</head>

<body>
    <div class="main-container" style="width: 100%; height: 100%">
        <div id="chart1-example" style="position: relative; width: 100%; height: 100%;"></div>
    </div>
    <script src="js/mapd-draw-dev.js"></script>
    <script>
    function init() {
      const parent = document.getElementById("chart1-example")

      const width = parent.offsetWidth
      const height = parent.offsetHeight

      const drawEngine = new MapdDraw.ShapeBuilder(parent, {
        enableInteractions: true,
        cameraPosition: [0, 0]
      })

      const circle = new MapdDraw.Circle({
        position: [0, 0],
        radius: 50,
        fillColor: "rgba(0,0,255,1.0)",
        strokeColor: "red",
        strokeWidth: 3,
        dashPattern: [10, 3]
      })
      circle.scale([2, 1])
      drawEngine.addShape(circle)

      const rect = new MapdDraw.Rect({
        position: [150, 150],
        width: 100,
        height: 100,
        fillColor: "rgba(0,255,0,0.5)",
        strokeColor: "red",
        strokeWidth: 3,
        dashPattern: [10, 3]
      })
      drawEngine.addShape(rect)

      const verts = [
        [-100, -100],
        [100, -100],
        [0, -300]
      ]
      const poly = new MapdDraw.Poly({
        verts: verts,
        fillColor: "rgba(0,255,0,0.5)"
      })
      drawEngine.addShape(poly)

      circle.id = "ABC123"
      circle.on('changed', (eventData) => {
        console.log(`Modified - this: ${this}, event type: ${eventData.type}, who changed: ${eventData.target.id}, what changed: property ${eventData.attr} from ${eventData.prevVal} to ${eventData.currVal}`)
      })

      parent.addEventListener("click", (event) => {
        const screenToWorldMatrix = drawEngine._camera.screenToWorldMatrix
        const worldToScreenMatrix = drawEngine._camera.worldToScreenMatrix

        const mousept = MapdDraw.Point2d.create(event.offsetX, event.offsetY)
        const worldmousept = MapdDraw.Point2d.create()
        MapdDraw.Point2d.transformMat2d(worldmousept, mousept, screenToWorldMatrix)

        const shapes = drawEngine.sortedShapes

        // Checks whether the click is under any shape
        // This includes checking whether the UI elements for selected shapes are also clicked
        let i = -1
        for (i = shapes.length - 1; i >= 0; i -= 1) {
          if (shapes[i].selected) {
            // shape is selected, so check to see if the click occurred
            // on the UI drawn for manipulating the shape (i.e. scale/rotate)
            const selectedShape = drawEngine._selectedShapes.get(shapes[i])
            let hitInfo = null
            if (selectedShape &&
                 (hitInfo = selectedShape.containsPoint(mousept, worldmousept, worldToScreenMatrix, drawEngine._drawCtx)).hit) {
              console.log("Hit manip UI elements for shape: " + i)
              break
            }
          }

          if (shapes[i].containsPoint(mousept, worldmousept, worldToScreenMatrix, drawEngine._drawCtx)) {
            console.log("Hit shape: " + i)
            break;
          }
        }
      })
    }

    document.addEventListener('DOMContentLoaded', init, false)
    </script>
</body>

</html>
